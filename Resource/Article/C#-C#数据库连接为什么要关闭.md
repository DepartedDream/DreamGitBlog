# 数据库连接一定要关闭

Connection用完（打开过后）是必须关闭的，不能不关闭。

# 数据库连接为什么要关闭

* 数据库连接是一种昂贵的资源，所以系统对它进行了特殊的处理,启用了池机制,这个池我们叫做连接池（线程类似的就叫线程池）
* 系统在初始化的时候，会建立连接池，接着初始化一定数目的数据库连接放在里面，需要使用的时候，从池里选出一个空闲的数据库连接，用完后再放回池中，从而实现数据库连接的复用。
* 数据库连接和普通对象不一样。普通对象用完会从内存中清除，而数据库连接却是要回到连接池的。
* 如果用完后没有关闭它，会导致它无法再回到连接池，也就无法再次被利用，当连接池中的连接全部用完了，就会发生异常，
* 即使声明为局部变量，只要没有明确地关闭，数据库连接也不会因为“超过了声明范围”而被自动关闭。

# 数据库连接不需要手动关闭的情况

* 使用using来引用连接，using是一个特殊的关键字，当变量离开using声明的区域时，会隐式调用Dispose（和Close是一样的）；
* 数据库连接的执行返回了一个DataReader并指定了“关闭时一起关闭连接”的选项，则关闭DataReader时就会关闭数据库连接。

# 导致数据库连接泄漏的Bug

* 打开后却忘记关闭
* 使用了using，但是却返回了一个DataReader，或者打开了却因为返回DataReader所以不能关闭，而调用程序调用完后忘记关闭DataReader或者忘记关闭
连接（如果没有为DataReader指定同时关闭数据库连接的选项）

# 参考

["c# conn.open（） 不需要conn.close 关于内存释放问题"](https://zhidao.baidu.com/question/228922420.html)